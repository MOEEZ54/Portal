<div class="fp-container">
  <div class="fp-card">
    <h2 class="fp-title">Forgot Password</h2>
    <p class="fp-subtitle">We‚Äôll send you an OTP to reset your password</p>

    <!-- ================= STEP 1: SEND OTP ================= -->
    <form *ngIf="step === 1" #f1="ngForm" (ngSubmit)="sendOtp(f1)" novalidate>
      <div class="field">
        <label>Email</label>
        <input
          type="email"
          name="email"
          [(ngModel)]="email"
          required
          email
          placeholder="Enter your email"
          autocomplete="email"
        />
      </div>

      <button class="fp-primary-btn" type="submit" [disabled]="isSubmitting">
        {{ isSubmitting ? 'Sending...' : 'Send OTP' }}
      </button>

      <p class="error" *ngIf="errorMsg">{{ errorMsg }}</p>
      <p class="success" *ngIf="successMsg">{{ successMsg }}</p>
    </form>

    <!-- ================= STEP 2A: VERIFY OTP ================= -->
    <form *ngIf="step === 2 && !otpVerified" #otpForm="ngForm" (ngSubmit)="verifyOtp(otpForm)" novalidate>
      <div class="field">
        <label>Email</label>
        <input type="text" [value]="email" readonly />
      </div>

      <div class="field">
        <label>OTP</label>
        <input
          type="text"
          name="otp"
          [(ngModel)]="otp"
          required
          minlength="6"
          maxlength="6"
          pattern="^[0-9]{6}$"
          inputmode="numeric"
          autocomplete="one-time-code"
          placeholder="Enter 6 digit OTP"
        />
      </div>

      <div class="otp-row">
        <small class="timer" *ngIf="otpSecondsLeft > 0">
          Resend available in {{ otpSecondsLeft }}s
        </small>

        <button
          type="button"
          class="resend-btn"
          (click)="resendOtp()"
          [disabled]="isSubmitting || otpSecondsLeft > 0"
        >
          Resend OTP
        </button>
      </div>

      <button class="fp-primary-btn" type="submit" [disabled]="isSubmitting">
        {{ isSubmitting ? 'Verifying...' : 'Verify OTP' }}
      </button>

      <p class="error" *ngIf="errorMsg">{{ errorMsg }}</p>
      <p class="success" *ngIf="successMsg">{{ successMsg }}</p>
    </form>

    <!-- ================= STEP 2B: RESET PASSWORD ================= -->
    <form *ngIf="step === 2 && otpVerified" #pwdForm="ngForm" (ngSubmit)="resetPassword(pwdForm)" novalidate>
      <div class="field">
        <label>Email</label>
        <input type="text" [value]="email" readonly />
      </div>

      <input type="hidden" name="otp" [value]="otp" />

      <div class="field">
        <label>New Password</label>

        <div class="password-wrap">
          <input
            [type]="showPassword ? 'text' : 'password'"
            name="newPassword"
            [(ngModel)]="newPassword"
            required
            minlength="6"
            placeholder="Enter new password"
            autocomplete="new-password"
          />

          <!-- üëÅÔ∏è Eye icon -->
          <button
            type="button"
            class="eye-btn"
            (click)="togglePassword()"
            [attr.aria-label]="showPassword ? 'Hide password' : 'Show password'"
          >
            <!-- eye open -->
            <svg *ngIf="!showPassword" class="eye-ico" viewBox="0 0 24 24">
              <path d="M12 5c-7 0-11 7-11 7s4 7 11 7 11-7 11-7-4-7-11-7zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10z"></path>
              <path d="M12 9a3 3 0 1 0 0 6 3 3 0 0 0 0-6z"></path>
            </svg>

            <!-- eye closed -->
            <svg *ngIf="showPassword" class="eye-ico" viewBox="0 0 24 24">
              <path d="M2 5.27 3.28 4 20 20.72 18.73 22l-3.1-3.1A11.7 11.7 0 0 1 12 19c-7 0-11-7-11-7a20.6 20.6 0 0 1 4.29-5.57L2 5.27z"></path>
              <path d="M12 7c.9 0 1.77.14 2.6.4l-1.9 1.9A3 3 0 0 0 9.3 12.7l-2.2 2.2A5 5 0 0 1 12 7z"></path>
            </svg>
          </button>
        </div>

        <div class="pw-meta">
          <small class="pw-hint">Minimum <strong>6</strong> characters</small>
          <div class="pw-strength">
            <span class="bar" [class.active]="(newPassword.length || 0) >= 1"></span>
            <span class="bar" [class.active]="(newPassword.length || 0) >= 4"></span>
            <span class="bar" [class.active]="(newPassword.length || 0) >= 8"></span>
          </div>
        </div>
      </div>

      <button class="fp-primary-btn" type="submit" [disabled]="isSubmitting">
        {{ isSubmitting ? 'Saving...' : 'Reset Password' }}
      </button>

      <p class="success">OTP verified.</p>
      <p class="error" *ngIf="errorMsg">{{ errorMsg }}</p>
    </form>

    <div class="divider"></div>

    <div class="back-login">
      <a routerLink="/login">‚Üê Back to Login</a>
    </div>
  </div>
</div>
